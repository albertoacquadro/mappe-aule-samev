function render(filtro = "") {
  lista.innerHTML = "";
  const testo = normalizza(filtro);

  // Campus sempre visibile
  const campus = document.createElement("li");
  campus.textContent = "Mappa del Campus";
  campus.className = "titolo-nc";
  campus.onclick = () => apri("generale.jpg");
  lista.appendChild(campus);

  // Costruiamo struttura per palazzina
  let sezioneCorrente = null;
  const sezioni = [];

  dati.forEach(d => {
    if (d.tipo === "titolo") {
      sezioneCorrente = {
        nome: d.nome,
        aule: []
      };
      sezioni.push(sezioneCorrente);
    } else if (!d.tipo && sezioneCorrente) {
      sezioneCorrente.aule.push(d);
    }
  });

  // Render sezioni
  sezioni.forEach(sezione => {
    const auleFiltrate = testo
      ? sezione.aule.filter(a =>
          normalizza(a.nome).includes(testo)
        )
      : sezione.aule;

    if (auleFiltrate.length === 0) return;

    const liTitolo = document.createElement("li");
    liTitolo.textContent = sezione.nome;
    liTitolo.className = testo ? "titolo" : "titolo chiuso";

    const ul = document.createElement("ul");
    if (!testo) ul.classList.add("nascosto");

    // ACCORDION UNO ALLA VOLTA (SOLO TRA SEZIONI)
    liTitolo.onclick = () => {
      sezioni.forEach(s => {
        if (s.ul && s.ul !== ul) {
          s.ul.classList.add("nascosto");
          s.li.classList.add("chiuso");
        }
      });
      ul.classList.toggle("nascosto");
      liTitolo.classList.toggle("chiuso");
    };

    // memorizziamo riferimenti
    sezione.ul = ul;
    sezione.li = liTitolo;

    auleFiltrate.forEach(a => {
      const li = document.createElement("li");
      const link = document.createElement("a");
      link.textContent = a.nome;
      link.onclick = () => apri(a.link);
      li.appendChild(link);
      ul.appendChild(li);
    });

    lista.appendChild(liTitolo);
    lista.appendChild(ul);
  });
}
